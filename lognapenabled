KubeNodeInventory | where TimeGenerated >= ago(5m) | extend aksnodeclass = tostring(parse_json(Labels)['karpenter.azure.com/aksnodeclass']) | extend autoscalerLabel = tostring(parse_json(Labels)['k8s.io/cluster-autoscaler']) | extend autoscalerEnabledLabel = tostring(parse_json(Labels)['kubernetes.io/cluster-autoscaler-enabled']) | summarize IsNAPEnabled = countif(aksnodeclass != "") > 0, IsAutoscalerEnabled = countif(autoscalerLabel != "" or autoscalerEnabledLabel == "true") > 0 by ClusterName | project ClusterName, Status = case( IsNAPEnabled and IsAutoscalerEnabled, "NAP and Cluster Autoscaler Enabled", IsNAPEnabled, "NAP Enabled", IsAutoscalerEnabled, "Cluster Autoscaler Enabled", "Neither Enabled" ) | order by ClusterName asc
