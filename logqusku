KubeNodeInventory
| where TimeGenerated > ago(10m)
| where status == "Ready"
| extend nodepoolType = todynamic(Labels)
| where isnotnull(nodepoolType)
| extend NodePool = coalesce(
    tostring(nodepoolType.agentpool),
    tostring(nodepoolType.kubernetes_azure_com_agentpool),
    tostring(nodepoolType["agentpool"])
), VM_SKU = coalesce(
    tostring(nodepoolType.node_kubernetes_io_instance_type),
    tostring(nodepoolType["node.kubernetes.io/instance-type"])
)
| where isnotempty(NodePool) and isnotempty(VM_SKU)
| summarize NodeCount = count(NodeName) by ClusterName, NodePool, VM_SKU
| order by ClusterName asc, NodePool asc, VM_SKU asc
