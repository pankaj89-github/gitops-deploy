Resources
| where type == "microsoft.containerservice/managedclusters"
| extend agentPoolExists = isnotempty(properties.agentPoolProfiles),
         cmkEnabled = case(
             isnotempty(properties.agentPoolProfiles), 
             array_length(properties.agentPoolProfiles) > 0 and any(properties.agentPoolProfiles, ap, isnotempty(ap.osDisk.diskEncryptionSet)),
             isnotempty(properties.diskEncryptionSetId) or toboolean(properties.enableDiskEncryption),
             false),
         mmkEnabled = case(
             isnotempty(properties.agentPoolProfiles), 
             array_length(properties.agentPoolProfiles) > 0 and any(properties.agentPoolProfiles, ap, isempty(ap.osDisk.diskEncryptionSet)),
             isempty(properties.diskEncryptionSetId) and not(toboolean(properties.enableDiskEncryption)),
             true)
| project subscriptionId, 
         resourceGroup, 
         aksName = name, 
         location, 
         cmkEnabled = iff(cmkEnabled, "Enabled", "Disabled"),
         mmkEnabled = iff(mmkEnabled, "Enabled", "Disabled"),
         agentPoolExists = iff(agentPoolExists, "Yes", "No"),
         provisioningState = tostring(properties.provisioningState)
